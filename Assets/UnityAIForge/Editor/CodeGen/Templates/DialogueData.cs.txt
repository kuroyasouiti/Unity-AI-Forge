using System.Collections.Generic;
using UnityEngine;

/// <summary>
/// Dialogue tree data with branching nodes, choices, conditions, and actions.
/// Generated by Unity-AI-Forge.
/// </summary>
[CreateAssetMenu(menuName = "Game/{{CLASS_NAME}}", fileName = "New{{CLASS_NAME}}")]
public class {{CLASS_NAME}} : ScriptableObject
{
    #region Types

    public enum NodeType { Dialogue, Choice, Branch, Action, Exit }
    public enum ConditionType { Quest, Resource, Inventory, Variable, Health, Custom }
    public enum ComparisonOperator { Equals, NotEquals, GreaterThan, LessThan, GreaterOrEqual, LessOrEqual, Contains }
    public enum ActionType { StartQuest, CompleteQuest, AddResource, RemoveResource, AddItem, RemoveItem, SetVariable, PlayEffect, Custom }

    [System.Serializable]
    public class DialogueNode
    {
        public string nodeId;
        public NodeType type = NodeType.Dialogue;
        public string speaker;
        [TextArea(2, 5)] public string text;
        public string portraitPath;
        public string voiceClipPath;
        public string soundEffectPath;
        public string nextNodeId;
        public List<DialogueChoice> choices = new List<DialogueChoice>();
        public List<DialogueCondition> conditions = new List<DialogueCondition>();
        public List<DialogueAction> actions = new List<DialogueAction>();
    }

    [System.Serializable]
    public class DialogueChoice
    {
        public string choiceId;
        [TextArea(1, 3)] public string text;
        public string targetNodeId;
        public bool isDefault;
        public List<DialogueCondition> conditions = new List<DialogueCondition>();
        public List<DialogueAction> actions = new List<DialogueAction>();
    }

    [System.Serializable]
    public class DialogueCondition
    {
        public ConditionType type;
        public string target;
        public string property;
        public ComparisonOperator comparison;
        public string value;
        public bool negate;
    }

    [System.Serializable]
    public class DialogueAction
    {
        public ActionType type;
        public string target;
        public string parameter;
        public float numericValue;
    }

    #endregion

    [Header("Identity")]
    public string dialogueId = "{{DIALOGUE_ID}}";

    [Header("Settings")]
    public string startNodeId = "start";
    public bool autoAdvance;
    public float autoAdvanceDelay = 2f;

    [Header("Nodes")]
    public List<DialogueNode> nodes = new List<DialogueNode>();

    #region API

    public DialogueNode GetNode(string nodeId)
    {
        return nodes.Find(n => n.nodeId == nodeId);
    }

    public DialogueNode GetStartNode()
    {
        return GetNode(startNodeId) ?? (nodes.Count > 0 ? nodes[0] : null);
    }

    public void AddNode(DialogueNode node)
    {
        if (node != null && !string.IsNullOrEmpty(node.nodeId))
            nodes.Add(node);
    }

    public void RemoveNode(string nodeId)
    {
        nodes.RemoveAll(n => n.nodeId == nodeId);
    }

    #endregion
}
